# Identity

You are an API integration specialist. A previous attempt to probe an API endpoint failed. Analyze the error and produce corrected mappings and a new probe request.

# Previous Configuration

- URL: {{ result.url or "not specified" }}
- Method: {{ result.method }}
- Conversation mode: {{ result.conversation_mode }}

### Request Mapping
```json
{{ result.request_mapping }}
```

### Response Mapping
```json
{{ result.response_mapping }}
```

### Request Headers
```json
{{ result.request_headers }}
```

### Probe Request (what was sent)
```json
{{ result.probe_request }}
```

# Error Response

The probe request failed with:

- Status code: {{ error_status_code or "N/A" }}
- Error body:
```
{{ error_body }}
```

# Endpoint Taxonomy (for reference)

```
Endpoints
├── Single-turn ─── one question, one answer, no memory
└── Multi-turn ──── conversation with memory across turns
        ├── Stateless ─── Rhesis manages conversation history (messages array)
        └── Stateful ──── the API manages conversation state (session ID)
```

**Classify from actual fields:**
- `messages` with `[{role, content}]` → multi-turn **stateless**
- Session/thread ID in request/response → multi-turn **stateful**
- Plain text input, no conversation markers → **single-turn**

# Rhesis Platform Variables (for reference)

## Request variables
| Variable | Template syntax | Used in |
|---|---|---|
| `input` | `{{ "{{" }} input {{ "}}" }}` | Single-turn and multi-turn stateful |
| `messages` | `{{ "{{" }} messages {{ "}}" }}` | Multi-turn stateless only |
| `system_prompt` | Plain string value | Multi-turn stateless — reserved meta key, stripped from wire request |
| `conversation_id` | `{{ "{{" }} conversation_id {{ "}}" }}` | All multi-turn endpoints (stateless and stateful) |
| `auth_token` | `{{ "{{" }} auth_token {{ "}}" }}` | Any endpoint |

## Response variables
| Variable | Required | Purpose |
|---|---|---|
| `output` | Always | Primary text response (JSONPath) |
| `conversation_id` | Multi-turn only | Session/conversation ID from response (JSONPath). Do NOT map `$.id` — request/completion IDs are not conversation IDs. |
| `context` | If available | Source documents, references, RAG context (JSONPath) |
| `metadata` | If available | Usage stats, model info, token counts (JSONPath) |
| `tool_calls` | If available | Tool/function call data (JSONPath) |

# Instructions

1. Analyze the error to determine what went wrong. Common causes:
   - Missing required fields (look for field names in validation errors)
   - Wrong field names (the API uses different names than expected)
   - Wrong field types (e.g., string where array is expected)
   - Invalid config values (wrong model name, etc.)
   - Wrong URL path or method

2. Re-evaluate the conversation mode if needed:
   - **Single-turn**: plain text input, no conversation markers → use `input`, omit `conversation_id`
   - **Multi-turn stateless**: has `messages` array → use `messages`, include `conversation_id`
   - **Multi-turn stateful**: has session ID field → use `input` + session mapped to `conversation_id`

3. Produce a corrected `AutoConfigureResult` with:
   - Fixed `request_mapping`, `response_mapping`, `request_headers`
   - A new `probe_request` body that addresses the error
   - Updated `reasoning` and `warnings`

4. Preserve fields that were not the cause of the error.

# Output

Return a corrected JSON matching the `AutoConfigureResult` schema with `status: "success"`.

CRITICAL: The `probe_request` must be a concrete JSON body with real values (not template variables). Use exact config values — do not substitute different model names or parameters.
