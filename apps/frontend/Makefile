# Frontend Makefile
# Mimics the validation script behavior with focus on errors only

.PHONY: help lint lint-fast clean format format-check type-check eslint test build install

# Default target
help:
	@echo "Available targets:"
	@echo "  lint         - Run all linting checks (format, type-check, eslint, build)"
	@echo "  lint-fast    - Run fast linting checks (skip build validation)"
	@echo "  clean        - Remove build artifacts"
	@echo "  format       - Auto-fix code formatting"
	@echo "  format-check - Check code formatting (errors only)"
	@echo "  type-check   - Run TypeScript type checking"
	@echo "  eslint       - Run ESLint (errors only)"
	@echo "  test         - Run tests"
	@echo "  build        - Build the application"
	@echo "  install      - Install dependencies"

# Main lint target - runs all validation steps (full by default)
lint: clean format-check type-check eslint build
	@echo ""
	@echo "âœ… All lint checks passed!"
	@echo "  âœ“ Code formatting"
	@echo "  âœ“ TypeScript validation"
	@echo "  âœ“ ESLint (errors only)"
	@echo "  âœ“ Build process"
	@echo ""
	@echo "ğŸ’¡ Tip: Use 'make lint-fast' to skip build validation for faster checks"

# Fast lint without build step
lint-fast: format-check type-check eslint
	@echo ""
	@echo "âœ… Fast lint checks passed!"
	@echo "  âœ“ Code formatting"
	@echo "  âœ“ TypeScript validation"
	@echo "  âœ“ ESLint (errors only)"
	@echo "  âš  Build validation skipped (use 'make lint' for full validation)"
	@echo ""

# Clean build artifacts
clean:
	@echo "ğŸ—‘ï¸ Cleaning .next folder..."
	@npm run clean

# Auto-fix formatting issues
format:
	@echo "ğŸ”§ Auto-fixing code formatting..."
	@npm run format

# Check formatting (fail on errors only)
format-check:
	@echo "ğŸ” Checking code formatting..."
	@npm run format:check || (echo "âŒ Code formatting failed" && exit 1)

# TypeScript type checking
type-check:
	@echo "ğŸ” Checking for TypeScript errors..."
	@npm run type-check || (echo "âŒ TypeScript validation failed" && exit 1)

# ESLint - errors only, ignore warnings
eslint:
	@echo "ğŸ” Running ESLint (errors only)..."
	@if npm run lint 2>&1 | grep -q "Error:"; then \
		echo "âŒ ESLint found errors (not just warnings)"; \
		exit 1; \
	else \
		echo "âœ… Only ESLint warnings found (no errors)"; \
	fi

# Run tests
test:
	@echo "ğŸ” Running tests..."
	@npm test -- --passWithNoTests --watchAll=false || (echo "âŒ Tests failed" && exit 1)

# Build the application
build:
	@echo "ğŸ” Testing build process..."
	@npx next build || (echo "âŒ Build process failed" && exit 1)
	@echo "ğŸ—‘ï¸ Cleaning up build artifacts..."
	@npm run clean

# Install dependencies
install:
	@echo "ğŸ“¦ Installing dependencies..."
	@npm ci --legacy-peer-deps
