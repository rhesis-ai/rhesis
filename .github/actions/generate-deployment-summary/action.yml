name: 'Generate Deployment Summary'
description: 'Generates deployment summary for both regular and preview deployments'
inputs:
  service-type:
    description: 'Service type (Backend, Frontend)'
    required: true
  is-preview:
    description: 'Whether this is a preview deployment'
    required: true
    default: 'false'
  environment:
    description: 'Environment (dev, stg, prd)'
    required: true
  env-display:
    description: 'Human-readable environment name'
    required: true
  service-url:
    description: 'Service URL to display'
    required: true
runs:
  using: 'composite'
  steps:
    - name: Generate deployment summary
      shell: bash
      run: |
        echo "" >> $GITHUB_STEP_SUMMARY
        
        if [ "${{ inputs.is-preview }}" = "true" ]; then
          # Preview deployment summary
          echo "## ðŸŒ âš ï¸ PREVIEW - ${{ inputs.service-type }} Service Deployed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ”— Access Information" >> $GITHUB_STEP_SUMMARY
          printf "**ðŸ§ª Preview URL:** [%s](%s)\n" "${{ inputs.service-url }}" "${{ inputs.service-url }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### âš ï¸ Preview Warning" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸš« **This is a PREVIEW deployment, NOT live ${{ inputs.environment }}**" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ“Š **Receives 0% live traffic**" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ”’ **Isolated from live environment**" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ”— **Only accessible via the tagged URL above**" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ§ª **For testing and review purposes only**" >> $GITHUB_STEP_SUMMARY
        else
          # Regular deployment summary
          echo "## ðŸŒ âœ… ${{ inputs.env-display }} - ${{ inputs.service-type }} Service Deployed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ”— Access Information" >> $GITHUB_STEP_SUMMARY
          printf "**ðŸŒ ${{ inputs.env-display }} URL:** [%s](%s)\n" "${{ inputs.service-url }}" "${{ inputs.service-url }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### âœ… ${{ inputs.env-display }} Status" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸš€ **This is the LIVE ${{ inputs.env-display }} service**" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ inputs.environment }}" = "prd" ]; then
            echo "- ðŸ“ˆ **Serving real user traffic**" >> $GITHUB_STEP_SUMMARY
            echo "- ðŸ”´ **Handle with care - affects users**" >> $GITHUB_STEP_SUMMARY
          else
            echo "- ðŸ§ª **Serving ${{ inputs.env-display }} environment traffic**" >> $GITHUB_STEP_SUMMARY
            echo "- âš ï¸ **Handle with care - affects ${{ inputs.env-display }} users**" >> $GITHUB_STEP_SUMMARY
          fi
        fi
        
        echo "âœ… Deployment summary generated for ${{ inputs.service-type }} (${{ inputs.is-preview == 'true' && 'PREVIEW' || inputs.env-display }})"

